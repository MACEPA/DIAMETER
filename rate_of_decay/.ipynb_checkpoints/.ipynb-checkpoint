{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import math\n",
    "from functools import reduce\n",
    "from sklearn import linear_model\n",
    "from sklearn.preprocessing import PolynomialFeatures\n",
    "import matplotlib.pyplot as plt"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'analyze the decay rate of each antigen at the specific concentration which was subjected to different treatment.'"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"analyze the decay rate of each antigen at the specific concentration which was subjected to different treatment.\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>time_or_humidity</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>-20oC</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1546.99</td>\n",
       "      <td>806.53</td>\n",
       "      <td>79.33</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>-20oC</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1300.62</td>\n",
       "      <td>791.51</td>\n",
       "      <td>64.99</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>-20oC</td>\n",
       "      <td>7.0</td>\n",
       "      <td>1582.84</td>\n",
       "      <td>897.24</td>\n",
       "      <td>88.90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>-20oC</td>\n",
       "      <td>15.0</td>\n",
       "      <td>1547.39</td>\n",
       "      <td>691.08</td>\n",
       "      <td>67.17</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>-20oC</td>\n",
       "      <td>30.0</td>\n",
       "      <td>1648.93</td>\n",
       "      <td>927.27</td>\n",
       "      <td>93.60</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  analyte treatment_condition  time_or_humidity       Hi     Med    Low\n",
       "0    HRP2               -20oC               1.0  1546.99  806.53  79.33\n",
       "1    HRP2               -20oC               3.0  1300.62  791.51  64.99\n",
       "2    HRP2               -20oC               7.0  1582.84  897.24  88.90\n",
       "3    HRP2               -20oC              15.0  1547.39  691.08  67.17\n",
       "4    HRP2               -20oC              30.0  1648.93  927.27  93.60"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "main_df = pd.read_excel('C:/Users/lzoeckler/Desktop/decay/DBS_stability_2.xlsx')\n",
    "main_df.rename(columns={'Unnamed: 0': 'analyte', 'Unnamed: 1': 'treatment_condition',\n",
    "                       'Unnamed: 2': 'time_or_humidity'}, inplace=True)\n",
    "main_df.loc[main_df['analyte'] == 'Pv LDH', 'analyte'] = 'Pv_LDH'\n",
    "main_df.loc[main_df['analyte'] == 'Pf LDH', 'analyte'] = 'Pf_LDH'\n",
    "main_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['HRP2', 'Pv_LDH', 'Pf_LDH', 'CRP'], dtype=object)"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "main_df['analyte'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "def temp_adjust(df):\n",
    "    temp = df['treatment_condition']\n",
    "    temp = temp.replace(\"oC\", \"\")\n",
    "    temp = int(temp)\n",
    "    return temp"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\lzoeckler\\miniconda3\\envs\\DIAMETER\\lib\\site-packages\\ipykernel_launcher.py:2: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  \n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "array([-20,   4,  23,  30,  50], dtype=int64)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "time_df = main_df.loc[main_df['treatment_condition'] != 'Humidity']\n",
    "time_df['treatment_condition'] = time_df.apply(temp_adjust, axis=1)\n",
    "time_df['treatment_condition'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([  1.,   3.,   7.,  15.,  30.,  60., 120., 240.])"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "time_df['time_or_humidity'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>time_or_humidity</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>48</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>1.0</td>\n",
       "      <td>14046.28</td>\n",
       "      <td>8512.34</td>\n",
       "      <td>699.70</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>3.0</td>\n",
       "      <td>10830.68</td>\n",
       "      <td>6827.24</td>\n",
       "      <td>733.67</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>7.0</td>\n",
       "      <td>12851.85</td>\n",
       "      <td>6780.80</td>\n",
       "      <td>1020.71</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>15.0</td>\n",
       "      <td>10828.34</td>\n",
       "      <td>6620.00</td>\n",
       "      <td>717.24</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>30.0</td>\n",
       "      <td>11073.76</td>\n",
       "      <td>7259.36</td>\n",
       "      <td>726.47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>53</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>60.0</td>\n",
       "      <td>9051.57</td>\n",
       "      <td>6087.39</td>\n",
       "      <td>734.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>54</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>120.0</td>\n",
       "      <td>10267.39</td>\n",
       "      <td>5463.79</td>\n",
       "      <td>567.97</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4</td>\n",
       "      <td>240.0</td>\n",
       "      <td>8830.77</td>\n",
       "      <td>5670.04</td>\n",
       "      <td>642.13</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   analyte  treatment_condition  time_or_humidity        Hi      Med      Low\n",
       "48  Pf_LDH                    4               1.0  14046.28  8512.34   699.70\n",
       "49  Pf_LDH                    4               3.0  10830.68  6827.24   733.67\n",
       "50  Pf_LDH                    4               7.0  12851.85  6780.80  1020.71\n",
       "51  Pf_LDH                    4              15.0  10828.34  6620.00   717.24\n",
       "52  Pf_LDH                    4              30.0  11073.76  7259.36   726.47\n",
       "53  Pf_LDH                    4              60.0   9051.57  6087.39   734.50\n",
       "54  Pf_LDH                    4             120.0  10267.39  5463.79   567.97\n",
       "55  Pf_LDH                    4             240.0   8830.77  5670.04   642.13"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "time_df.loc[(time_df['treatment_condition'] == 4)\n",
    "            & (time_df['analyte'] == 'Pf_LDH')]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>CRP</td>\n",
       "      <td>17950.92500</td>\n",
       "      <td>7628.23500</td>\n",
       "      <td>699.82500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>12022.15500</td>\n",
       "      <td>6948.41500</td>\n",
       "      <td>796.22750</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Pv_LDH</td>\n",
       "      <td>4976.20875</td>\n",
       "      <td>2897.74000</td>\n",
       "      <td>312.14625</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  analyte           Hi         Med        Low\n",
       "0     CRP  17950.92500  7628.23500  699.82500\n",
       "1    HRP2   1534.43625   825.94375   83.70375\n",
       "2  Pf_LDH  12022.15500  6948.41500  796.22750\n",
       "3  Pv_LDH   4976.20875  2897.74000  312.14625"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "base_value_df = time_df.loc[time_df['treatment_condition'] == -20]\n",
    "base_value_df = base_value_df.groupby(['analyte', 'treatment_condition']).mean().reset_index()\n",
    "base_value_df.drop(['treatment_condition', 'time_or_humidity'], axis=1, inplace=True)\n",
    "base_value_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>time_or_humidity</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "      <th>Hi_base</th>\n",
       "      <th>Med_base</th>\n",
       "      <th>Low_base</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>4</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1937.11</td>\n",
       "      <td>1006.40</td>\n",
       "      <td>79.08</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>4</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1438.96</td>\n",
       "      <td>875.57</td>\n",
       "      <td>76.59</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>4</td>\n",
       "      <td>7.0</td>\n",
       "      <td>1748.31</td>\n",
       "      <td>945.54</td>\n",
       "      <td>105.97</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>4</td>\n",
       "      <td>15.0</td>\n",
       "      <td>1563.24</td>\n",
       "      <td>809.20</td>\n",
       "      <td>73.14</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>4</td>\n",
       "      <td>30.0</td>\n",
       "      <td>1716.19</td>\n",
       "      <td>1039.20</td>\n",
       "      <td>222.44</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "  analyte  treatment_condition  time_or_humidity       Hi      Med     Low  \\\n",
       "0    HRP2                    4               1.0  1937.11  1006.40   79.08   \n",
       "1    HRP2                    4               3.0  1438.96   875.57   76.59   \n",
       "2    HRP2                    4               7.0  1748.31   945.54  105.97   \n",
       "3    HRP2                    4              15.0  1563.24   809.20   73.14   \n",
       "4    HRP2                    4              30.0  1716.19  1039.20  222.44   \n",
       "\n",
       "      Hi_base   Med_base  Low_base  \n",
       "0  1534.43625  825.94375  83.70375  \n",
       "1  1534.43625  825.94375  83.70375  \n",
       "2  1534.43625  825.94375  83.70375  \n",
       "3  1534.43625  825.94375  83.70375  \n",
       "4  1534.43625  825.94375  83.70375  "
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "time_df = time_df.loc[time_df['treatment_condition'] != -20]\n",
    "time_df = time_df.merge(base_value_df, on='analyte', suffixes=('', '_base'))\n",
    "time_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 71,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\lzoeckler\\miniconda3\\envs\\DIAMETER\\lib\\site-packages\\ipykernel_launcher.py:10: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  # Remove the CWD from sys.path while we load stuff.\n",
      "C:\\Users\\lzoeckler\\miniconda3\\envs\\DIAMETER\\lib\\site-packages\\pandas\\core\\indexing.py:543: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  self.obj[item] = s\n",
      "C:\\Users\\lzoeckler\\miniconda3\\envs\\DIAMETER\\lib\\site-packages\\pandas\\core\\frame.py:3940: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  errors=errors)\n"
     ]
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAX4AAAD4CAYAAADrRI2NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjAsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+17YcXAAAgAElEQVR4nO3deZRU1bn38e9DM9igsRlaLyCoKKICytAOUYNTlCvxCnrzLvVNjHEig8YhCQqvudGs5DoEo1kar4pTNBq8DogaveIUaYcrWIgyaQNOSIPQou1EqwjP+8eulqK7Guiq03Wq+vw+a9Wq7tM1PIdqfvv03ufsbe6OiIgkR4e4CxARkcJS8IuIJIyCX0QkYRT8IiIJo+AXEUmYjnEXANCrVy/fZZdd4i5DRKSkzJkz5wN3r2zt84oi+HfZZRdSqVTcZYiIlBQzezeX56mrR0QkYRT8IiIJo+AXEUkYBb+ISMIo+EVEEqYozuppL6bPrWXyjBpW1DfQp6KcCaMHMW5437jLEhHZhII/ItPn1jJp2nwa1q0HoLa+gUnT5gMo/EWkqKirJyKTZ9R8E/qNGtatZ/KMmpgqEhHJTsEfkRX1Da3aLiISly0Gv5ndZmarzWxBxrYeZvakmS1J33dPbzczu9bMlprZPDMb0ZbFF5M+FeWt2i4iEpetOeL/K/CvTbZNBJ5294HA0+nvAY4BBqZv44Eboimz+E0YPYjyTmWbbCvvVMaE0YNiqkhEJLstBr+7VwMfNtk8Frgj/fUdwLiM7Xd68BJQYWa9oyq2mI0b3pfLTxhK34pyDOhbUc7lJwzVwK6IFJ1cz+rZ0d1XArj7SjPbIb29L/BexuOWp7etbPoCZjae8FcB/fv3z7GM4jJueF8FvYgUvagHdy3Ltqyrubv7FHevcveqyspWzyoqIiI5yjX4VzV24aTvV6e3Lwf6ZTxuJ2BF7uWJiEjUcg3+h4FT01+fCjyUsf1H6bN7DgQ+buwSEhGR4rDFPn4zmwocBvQys+XAJcAVwL1mdgawDPg/6Yc/BowBlgJrgdPaoGYREcnDFoPf3U9u4UdHZnmsA2fnW5SIiLQdXbkrIpIwCn4RkYRR8IuIJIyCX0QkYRT8IiIJo+CP2s03wx57wJo1cVciIpKVgj9q//gHLFkC558fdyUiIlkp+KOWSkG3bnDXXaEREBEpMgr+KK1YEW6XXAJDhsBPfgL19XFXJSKyCQV/lObMCfcHHQS33w6rVsGvfhVvTSIiTSj4o5RKQYcOMGwYVFXBhAlw220wY0bclYmIfEPBH6VUCvbeO/TxQ+jy2WsvOOss+OSTeGsTEUlT8EfFPQR/VdXGbdtsE474a2vhwgvjq01EJIOCPyrLl8Pq1ZsGP8CBB8IFF8BNN8Ezz8RTm4hIBgV/VFKpcN80+AF+/3sYOBDOOAM++6ywdYmINKHgj0oqBR07wj77NP9ZeXno8nn3XZg0qfC1iYhkUPBHJZUK5+6Xl2f/+SGHwC9+AX/5C1RXF7Y2EZEMCv4oZBvYzeayy2DAADj9dFi7tjC1iYg0oeCPwjvvwIcfbjn4u3WDW2+FN9+E3/ymIKWJiDSl4I/C5gZ2mzrsMPjZz+DPf4YXX2zTskREsskr+M3sPDNbYGYLzez89LZLzazWzF5N38ZEU2oRS6Wgc+fQx781rrwS+vcPXT4NDW1bm4hIEzkHv5kNAc4C9gf2BY41s4HpH1/j7sPSt8ciqLO4vfxyOJunS5ete/x224V5+2tq4NJL27Q0EZGm8jni3wt4yd3XuvvXwEzg+GjKKiEbNoTJ2bammyfTUUfBmWfCVVfB7NltU5uISBb5BP8CYJSZ9TSzrsAYoF/6Z+eY2Twzu83Mumd7spmNN7OUmaXq6uryKCNmS5eGeXhaG/wQQr93bzjtNPjyy+hrExHJIufgd/fXgSuBJ4HHgdeAr4EbgN2AYcBK4E8tPH+Ku1e5e1VlZWWuZcSvNQO7TW2/PUyZAosWhat7RUQKIK/BXXe/1d1HuPso4ENgibuvcvf17r4BuJkwBtB+pVJhMrbBg3N7/pgx8KMfwRVXwCuvRFubiEgW+Z7Vs0P6vj9wAjDVzHpnPOR4QpdQ+5VKwfDhYbqGXF1zDVRWhi6fr76KrjYRkSzyPY//ATNbBDwCnO3uHwF/NLP5ZjYPOBy4IN8ii9b69eEoPZdunkw9esCNN8K8eXD55dHUJiLSgjwOU8Hdv5Nl2yn5vGZJqamBzz/PP/gBxo6Fk0+GP/wBjj8++2RvIiIR0JW7+chnYDeba68NR/+nnQbr1kXzmiIiTSj485FKhfl3Bg2K5vV69YLrrw/dR1ddFc1riog0oeDPRyoFI0ZAWVl0r/n974fbpZeG0zxFRCKm4M/V11/D3LnRdfNkuv76MK3D6aeHAWQRkQgp+HO1aBF88UXbBP8OO8B118GsWeFUTxGRCCn4cxX1wG5TJ50UzvT5j/+AxYvb5j1EJJEU/LlKpeBb34Ldd2+b1zeDG24ISzmqy0dEIqTgz1UqBSNHQoc2/Cfs3Tss2PLCC2GtXhGRCCj4c/HVV/Daa23XzZPplFPCfD6TJoUlG0VE8qTgz8WCBSH8CxH8ZnDTTdCpE5xxRpj/X0QkDwr+XLT1wG5TO+0EV18NM2eGOX1ERPKg4M9FKgXdu8OuuxbuPU8/HY4+Gi68EN55p3DvKyLtjoI/F6lUONo3K9x7moV1es3grLPAvXDvLSLtioK/tb74AubPL1w3T6b+/WHyZHjqKbjllsK/v4i0Cwr+1po3L0zXEEfwA4wfD4cfDr/6Fbz3Xjw1iEhJU/C3VqEHdpvq0CEc7a9fHxoBdfmISCsp+FsrlQrLJPbrF18NAwaElboefxzuuCO+OkSkJCn4WyuOgd1szjkHDjkELrgAVqyItxYRKSkK/tZYuxYWLoyvmydThw5w221hsPmnP1WXj4hsNQV/a7z6arhythiCH2DgwLBG7yOPwN//Hnc1IlIi8gp+MzvPzBaY2UIzOz+9rYeZPWlmS9L33aMptQjEPbCbzfnnw4EHwrnnwvvvx12NiJSAnIPfzIYAZwH7A/sCx5rZQGAi8LS7DwSeTn/fPqRSYcbMPn3irmSjsrLQ5fP553D22eryEZEtyueIfy/gJXdf6+5fAzOB44GxQOOpJncA4/IrsYg0DuwWm732Cmv0TpsG998fdzUiUuTyCf4FwCgz62lmXYExQD9gR3dfCZC+3yH/MovAp5/CG28UZ/AD/PrXobazz4a6urirEZEilnPwu/vrwJXAk8DjwGvA11v7fDMbb2YpM0vVlUJQzZ0bulGKNfg7doTbb4f6+tDfLyLSgrwGd939Vncf4e6jgA+BJcAqM+sNkL5f3cJzp7h7lbtXVVZW5lNGYbz8crgfOTLeOjZnyJCwRu8998D06XFXIyJFKt+zenZI3/cHTgCmAg8Dp6YfcirwUD7vUTRSqXC17o47xl3J5k2cCMOGhXP7P/ww7mpEpAjlex7/A2a2CHgEONvdPwKuAI4ysyXAUenvS1+xDuw21alT6PJZsyac6iki0kS+XT3fcfe93X1fd386vW2Nux/p7gPT96V/2PnRR7B0aWkEP4Qj/kmT4G9/g0cfjbsaESkyunJ3a7zySrjfb79462iN3/wm9PmPHx8GfEVE0tpt8E+fW8vBVzzDrhMf5eArnmH63NrcX6zxit1iHthtqnPn0OWzalWYu19EJK1dBv/0ubVMmjaf2voGHKitb2DStPm5h38qFaZC7tEj0jrbXFUVTJgQruydMSPuakSkSLTL4J88o4aGdes32dawbj2TZ9Tk9oKlMrCbzSWXhCt7zzoLPvkk7mpEpAi0y+BfUd/Qqu2b9cEH8M47pRv822zDzIuuYP3yWu4+9MT8u71EpOR1jLuAttCnopzaLCHfp6K89S82Z064L9Hgnz63lklLO3NB1VjGv/wgXb5ex59WnQ4cyrjhfeMuT0Ri0C6P+CeMHkR5p7JNtpV3KmPC6EGtf7HGgd0RIyKorPAau72uGvUjbjjg+xy3aCaP/deZLL/49/DVV3GXJyIxaJfBP254Xy4/YSh9K8oxoG9FOZefMDS3I9xUCvbYA7bfPvI6C6Gxe+urjp248rAfc/QZ1zO73xDO+Z+bYOjQsG6viCSKeRHM315VVeWpxiPrYtOvH4waBXffHXclOTn4imeydnt9//3XuOrFv8KSJXDccXD11bDbboUvUERyZmZz3L3V/dDt8og/Mu+/D8uXl2z/PrTc7XXIeafC/Plw5ZXwzDOw995w8cXw2WcxVSoihaLg35wSH9iFLXR7dekCF14INTVw4olw2WWw554wdapW8hJpx9TVszm/+124ffIJbLtt3NW0vRdfhF/8IkxRccghcN11Yd4fESlK6uppC6lUuPgpCaEPcNBBMHs23HxzWG1s5Ej42c/CtQwi0m4o+FviXtpX7OaqrAzOPBMWLw5H/zffHM5quv56+HqrF1gTkSKm4G/JihVhcDdpwd+oe3f485/htddg+HA455xwLcOzz8ZdmYjkScHfksYxh6QGf6PBg+Gpp+CBB8JYx+GHh4HgZcvirkxEcqTgb0kqFbo99t037kriZwYnnACLFsGll8LDD4ezf37/e2jIYf4jEYmVgr8lqVQ42u3aNe5KikfXrmG2zzfegO99D37723D+/4MP6vRPkRKi4M8mqQO7W2vnneG+++Dpp6Fbt/DXwOjR8PrrcVcmIltBwZ/NsmXhFEYF/+YdcQS8+ipcey28/DLssw/88pfw8cdxVyYim6Hgz0YDu1uvY8dw2ufixXD66eFMoD32CKt+bdgQd3UikkVewW9mF5jZQjNbYGZTzWwbM/urmb1tZq+mb6V36WcqBZ06hSNY2TqVlXDTTeHfbvfd4Ywz4IAD4KWX4q5MRJrIOfjNrC9wLlDl7kOAMuCk9I8nuPuw9O3VCOosrFQqTFncpUvclZSeESPg+efhrrugtha+/W348Y/DNREiUhTy7erpCJSbWUegK7Ai/5JipoHd/JnBD34QJn+bOBH+/vfQ/XPVVVr8RaQI5Bz87l4LXAUsA1YCH7v7E+kf/6eZzTOza8ws62GzmY03s5SZperq6nItI3pvvQX19Qr+KGy3HVx+OSxcCIceChMmaPEXkSKQT1dPd2AssCvQB+hmZj8EJgF7AvsBPYCLsj3f3ae4e5W7V1VWVuZaRvQ0sBu9gQPhkUfg0UfDX1THHANjx8Kbb8ZdmUgi5dPV813gbXevc/d1wDTgIHdf6cGXwO3A/lEUWjCpVOjbHzw47kranzFjYMEC+OMftfiLSIzyCf5lwIFm1tXMDDgSeN3MegOkt40DFuRfZgGlUmGahs6d466kfercOXT5LF68cfGXQYPCOICu/hUpiHz6+GcB9wOvAPPTrzUFuNvM5qe39QL+EEGdhbFhQ1h1S908ba93b7jzTnjhhfD1D34Q1jZ+tfROAhMpNXmd1ePul7j7nu4+xN1Pcfcv3f0Idx+a3vZDdy+dv+MXL4ZPP1XwF9JBB8GsWVr8RaSAdOVuJg3sxqNx8ZclS7T4i0gBKPgzpVJQXh6WW5TCq6jQ4i8iBaDgz5RKhcDp2DHuSpJNi7+ItCkFf6Ovv4a5c2G//eKuRGDj4i+vvw6/+50WfxGJkIK/0RtvwNq16t8vNuXlYcGXN96AY4/V4i8iEVDwN9LAbnHbeWe4995w4de224a/Bo4+Wou/iORAwd8olQqBsscecVcim3P44aFL7rrrwmemxV9EWk3B3yiVCueQd9A/SdHr2DGc8bN4cZj3X4u/iLSKUg5g3bpwxai6eUpLZSXceGNotAcO1OIvIltJwQ9h2uAvv1Twl6oRI+C557T4i8hWUvCDBnbbg6aLv0ydqsVfRFqg4Ad4+WXYfnvYbbe4K5F8NS7+smCBFn8RaYGCH0I3wUEHhaNGaR+yLf5y3HGwdGnclYnETsG/enU4F3zUqLgrkbaQufjLP/8ZpoPQ4i+ScAr+554L94ceGm8d0nYyF3856SQt/iKJp+Cvrg7TAowcGXcl0tZ694Y77oAXX9TiL5JoCv7q6tC/r6UWk+Pb34bZs+GWW8JZQFr8RRIm2cH/0Udh7nf17ydPhw7hgq/Fi7Mu/jJ9bi0HX/EMu058lIOveIbpc2vjrlgkMskO/hdeCH28Cv7kylz8ZcQIOOccPt5rKNOuvpva+gYcqK1vYNK0+Qp/aTeSHfzV1aGL54AD4q5E4jZ4MDz5JDzwAJ+vqefOuy7iLw9dyQHL5tN97cc0rFvP5Bk1cVcpEom8lpoyswuAMwEH5gOnAb2Be4AewCvAKe5enJdOzpwJ++8fBndF0ou/HPECnDV7Gj9/6X6OfSOc9fVB1+1Z0qs/LB8V1gMYPDjcV1bGXLRI6+Uc/GbWFzgX2NvdG8zsXuAkYAxwjbvfY2Y3AmcAN0RSbZQ++wzmzIGLLoq7EikyPSsruO7gk7lr+BiGvr+UgR8sY+Ca9xjy0Xvwt7+F5SAbVVZu2hA03u+wQ3w7ILIF+S4u2xEoN7N1QFdgJXAE8H/TP78DuJRiDP7//V9Yv17n70szE0YPYtK0+XzUdXuqB4ykesBIyjuVcfkJQxkyrE+YCG7RojC5X+P9XXdt2iD06tVyg6ArxCVmOQe/u9ea2VXAMqABeAKYA9S7+9fphy0H+mZ7vpmNB8YD9O/fP9cycjdzJpSVhVP7RDKMGx5+ZSfPqGFFfQN9KsqZMHrQN9vZaadwO/rojU9yhxUrNm0MFi0KF4llLhLTs2fzxmDwYDUIUlDmOV65aGbdgQeAE4F64L7095e4++7px/QDHnP3oZt7raqqKk81zpBZKKNGwRdfhPO5RdqKO6xc2bxBWLgQ6us3Pq5Hj+wNwo47qkGQFpnZHHdv9bTC+XT1fBd4293r0gVMAw4CKsysY/qofydgRR7v0Ta++AJmzYJzz427EmnvzKBPn3A76qiN293DegFNG4R77w3XlzTq3j17g/Av/6IGQXKWT/AvAw40s66Erp4jgRTwT+D7hDN7TgUeyrfIyM2aFeZo1/n7EhezMG1E797w3e9u3N7YIDT96+C++2DKlI2P6949+xhC795qEGSL8unjn2Vm9xNO2fwamAtMAR4F7jGzP6S33RpFoZGqrg7/OQ45JO5KRDaV2SAceeTG7e6walXzBuH+++HDDzc+rqIie4PQp48aBPlGzn38USp4H/9RR0FdnSbnktLnHqYWb9ogLFwIa9ZsfNz222dvEPr2VYNQwuLo4y9N69aF2RnPOCPuSkTyZxYGgHfcEQ4/fNOfrV7dfAxh+vQwOV2jb30re4Ow005qENqx5AX/nDmwdq3O35f2b4cdwq1pg1BX17xBePhhuDWjV7axQWjaKKhBaBeSF/zV1eH+O9+Jtw6RuFRWwmGHhVumurrQCGQ2CP/4B9x228bHbLdd9gahXz81CCUkeX383/sevPVWWG5RRLbsgw+ajyEsWhQGmxttu232BqF/fzUIbUh9/Ftj/Xp4/nk4+eS4KxEpHb16hVOfm57+vGZN8wbh8cfhr3/d+Jhtt4W99mo+htC/f1gTQWKRrOCfNy/Mp6Lz90Xy17Nn6DJt2m26Zk34i3pzDUK3btkbhJ13VoNQAMkK/pkzw72CX6Tt9OwZrpFpep3Mhx82H0N44omwDnKjrl2bNwiDB6tBiFiygr+6GgYMCGcmiEhh9eiRvUH46KPmDcJTT8Gdd258TGOD0HQMYZdd1CDkIDnB7x6C/9/+Le5KRCRT9+5w8MHhlqm+vnmD8MwzYU2ERuXlLTcIZWUF3Y1SkpzgX7Qo9D2qm0ekNFRUwEEHhVum+vrmYwjPPhvWRGhUXg577tm8Qdh1VzUIJCn4G8/f14VbIqWtoiKso9F0LY2PP27eIFRXw913b3zMNtuEBqHpoPKAAYlqEJIV/H37hhZfRNqf7beHAw8Mt0yffLLlBqFLl+wNwm67tcsGIRnB7x7O6Dn8cF1MIpI03/oWHHBAuGVqbBAyxxCefz6smtaoSxcYNKj5WUYDBkDH0o3P0q28Nd58M6yCpP59EWnUUoPw6afNG4QXX4SpUzc+pnPn7GMIu+1WEg1C8VcYhcb+fQW/iGzJdtvB/vuHW6bPPtu0QVi4EF56Ce65Z+NjOncOfyFkaxA6ddrk5abPrW15Xec2lozgnzkzTEy1555xVyIipWrbbWG//cIt02efwRtvbDqGMHs2/Pd/b3xMp06bNAizy3fk5reMVdvuiJd1pLa+gUnT5gMUJPyTMUnbrrvCyJFhtSIRkUL4/PPmDcKiRfD222HcEfiqQ0cuHv1z7tvnaAD6VpTzwsQjtvotNElbS5Ytg3fegQsuiLsSEUmSbt3CAefIkZtu//xzjj37FgZ+sIyBa5bxRuXGMw1X1DcUpLT2H/w6f19Eikm3bny051AerN+92Y/6VJQXpIT2P8lFdXW44GPIkLgrEREBYMLoQZR32vT6gPJOZUwYPagg75/zEb+ZDQIyRi8YAPwWqADOAurS2/+fuz+Wc4X5qq4Ok0K1w4swRKQ0NQ7gltxZPe5eAwwDMLMyoBZ4EDgNuMbdr4qkwny8/z7U1MCZZ8ZdiYjIJsYN71uwoG8qqq6eI4E33f3diF4vGs89F+51/r6IyDeiCv6TgIzL2jjHzOaZ2W1m1j3bE8xsvJmlzCxVV1eX7SH5q64OI+sjRrTN64uIlKC8g9/MOgPHAfelN90A7EboBloJ/Cnb89x9irtXuXtVZWVlvmU098EH8MADYVm4EriEWkSkUKI44j8GeMXdVwG4+yp3X+/uG4Cbgf03++y2sGEDnHpqmH//sssK/vYiIsUsikPhk8no5jGz3u6+Mv3t8cCCCN6jmc3Oc3H11fDYY/CXv8Dw4W3x9iIiJSuv4DezrsBRwE8yNv/RzIYBDrzT5GeRmD63lknT5tOwbj3ApvNcfPkeTJoE//7v8POfR/3WIiIlL6+uHndf6+493f3jjG2nuPtQd9/H3Y/LOPqPzOQZNTSsW8/OH61g4rO3U7ZhPQ3r1nPjgy/DiSdCv35wyy2ae19EJIuSHPVsnM/iu0tn89NZD7D3qrc4Z+xF/HLan8O8+y+8EK7WFRGRZkoy+PtUlFNb38Ct+43j085d+c8nrufZKePp0fAJXHNN82lTRUTkGyU5V0/mPBf37ns0PzzxDxiw4ohj4Lzz4i1ORKTIlWTwjxvel8tPGErfinIMWL7P/jz3zCv0efIf6tcXEdmCkuzqgejmuYhz+TMRkTiUbPBHYbOnhSr8RaSdKsmunqg0nhaaqWHdeibPqImpIhGRtpfo4G9pmbNCLX8mIhKHRAd/S8ucFWr5MxGROCQ6+ONe/kxEJA6JHtyNe/kzEZE4JDr4Id7lz0RE4pDorh4RkSRS8IuIJIyCX0QkYRT8IiIJo+AXEUkYBb+ISMIo+EVEEkbBLyKSMDkHv5kNMrNXM26fmNn5ZtbDzJ40syXp++5RFiwiIvnJOfjdvcbdh7n7MGAksBZ4EJgIPO3uA4Gn09+LiEiRiKqr50jgTXd/FxgL3JHefgcwLqL3EBGRCEQV/CcBU9Nf7+juKwHS9ztke4KZjTezlJml6urqIipDRES2JO/gN7POwHHAfa15nrtPcfcqd6+qrKzMtwwREdlKURzxHwO84u6r0t+vMrPeAOn71RG8h4iIRCSK4D+Zjd08AA8Dp6a/PhV4KIL3EBGRiOQV/GbWFTgKmJax+QrgKDNbkv7ZFfm8h4iIRCuvhVjcfS3Qs8m2NYSzfEREpAjpyl0RkYRR8IuIJIyCX0QkYRT8IiIJo+AXEUkYBb+ISMIo+EVEEkbBLyKSMAp+EZGEUfCLiCRMXlM2FIvpc2uZPKOGFfUN9KkoZ8LoQYwb3jfuskREilLJB//0ubVMmjafhnXrAaitb2DStPkACn8RkSxKvqtn8oyab0K/UcO69UyeURNTRSIixa3kg39FfUOrtouIJF3JB3+fivJWbRcRSbqSD/4JowdR3qlsk23lncqYMHpQTBWJiBS3kh/cbRzA1Vk9IiJbp+SDH0L4K+hFRLZOyXf1iIhI6yj4RUQSRsEvIpIwCn4RkYRR8IuIJIy5e9w1YGZ1wLs5PLUX8EHE5ZSSJO9/kvcdtP9J3v/Mfd/Z3Stb+wJFEfy5MrOUu1fFXUdckrz/Sd530P4nef+j2Hd19YiIJIyCX0QkYUo9+KfEXUDMkrz/Sd530P4nef/z3veS7uMXEZHWK/UjfhERaSUFv4hIwpRs8JvZv5pZjZktNbOJcdfT1szsHTObb2avmlkqva2HmT1pZkvS993jrjMqZnabma02swUZ27LurwXXpn8X5pnZiPgqj0YL+3+pmdWmfwdeNbMxGT+blN7/GjMbHU/V0TCzfmb2TzN73cwWmtl56e2J+Pw3s//Rff7uXnI3oAx4ExgAdAZeA/aOu6423ud3gF5Ntv0RmJj+eiJwZdx1Rri/o4ARwIIt7S8wBvgfwIADgVlx199G+38p8Ossj907/X+gC7Br+v9GWdz7kMe+9wZGpL/eDlic3sdEfP6b2f/IPv9SPeLfH1jq7m+5+1fAPcDYmGuKw1jgjvTXdwDjYqwlUu5eDXzYZHNL+zsWuNODl4AKM+tdmErbRgv735KxwD3u/qW7vw0sJfwfKUnuvtLdX0l//SnwOtCXhHz+m9n/lrT68y/V4O8LvJfx/XI2/w/THjjwhJnNMbPx6W07uvtKCL8swA6xVVcYLe1vkn4fzkl3Z9yW0bXXbvffzHYBhgOzSODn32T/IaLPv1SD37Jsa+/npR7s7iOAY4CzzWxU3AUVkaT8PtwA7AYMA1YCf0pvb5f7b2bbAg8A57v7J5t7aJZt7XH/I/v8SzX4lwP9Mr7fCVgRUy0F4e4r0vergQcJf8qtavyTNn2/Or4KC6Kl/U3E74O7r3L39e6+AbiZjX/Ot7v9N7NOhNC7292npTcn5vPPtv9Rfv6lGvwvAwPNbFcz6wycBDwcc01txsy6mdl2jV8DRwMLCPt8avphpwIPxVNhwbS0vw8DP0qf3XEg8HFjl0B70qTf+njC7wCE/T/JzLqY2a7AQGB2oeuLipkZcCvwurtfnfGjRB6lWdQAAACtSURBVHz+Le1/pJ9/3CPYeYx8jyGMdr8JXBx3PW28rwMIo/avAQsb9xfoCTwNLEnf94i71gj3eSrhz9l1hCOaM1raX8KfutenfxfmA1Vx199G+/+39P7NS/9n753x+IvT+18DHBN3/Xnu+yGErop5wKvp25ikfP6b2f/IPn9N2SAikjCl2tUjIiI5UvCLiCSMgl9EJGEU/CIiCaPgFxFJGAW/iEjCKPhFRBLm/wMdt7W0Hk1dXgAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "dfs = []\n",
    "#for analyte in time_df['analyte'].unique():\n",
    "for analyte in ['HRP2']:\n",
    "    an_df = time_df.loc[time_df['analyte'] == analyte]\n",
    "    #for concentration in ['Hi', 'Med', 'Low']:\n",
    "    for concentration in ['Low']:\n",
    "        con_df = an_df[['treatment_condition', 'time_or_humidity',\n",
    "                        concentration, '{}_base'.format(concentration)]]\n",
    "        end_df = con_df.loc[con_df['time_or_humidity'] == 240.0]\n",
    "        end_df['decay'] = True\n",
    "        end_df.loc[end_df[concentration] > end_df['{}_base'.format(concentration)], 'decay'] = False\n",
    "        end_df.drop(['time_or_humidity', concentration, '{}_base'.format(concentration)], axis=1, inplace=True)\n",
    "        con_df = con_df.merge(end_df, on=['treatment_condition'])\n",
    "        calc_df = con_df.loc[con_df['decay'] == True]\n",
    "        base_val = calc_df['{}_base'.format(concentration)].tolist()[0]\n",
    "        #for temp in an_df['treatment_condition'].unique():\n",
    "        for temp in [23]:\n",
    "            temp_df = calc_df.loc[calc_df['treatment_condition'] == temp]\n",
    "            temp_df.drop(['decay', 'treatment_condition', '{}_base'.format(concentration)], axis=1, inplace=True)\n",
    "            poly = PolynomialFeatures(degree=5)\n",
    "            regr = linear_model.LinearRegression()\n",
    "            time = temp_df['time_or_humidity'].values.reshape(-1,1)\n",
    "            con = temp_df[concentration].values.reshape(-1,1)\n",
    "            poly_time = poly.fit_transform(time)\n",
    "            regr.fit(poly_time, con)\n",
    "            pred = regr.predict(poly_time)\n",
    "            plt.scatter(time, con)\n",
    "            plt.plot(time, pred, color='red')\n",
    "            plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[-1.27285224e+12]])"
      ]
     },
     "execution_count": 69,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "regr.predict(poly.fit_transform([[2315]]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[77.84704868],\n",
       "       [78.22204755],\n",
       "       [78.95162679],\n",
       "       [80.3291113 ],\n",
       "       [82.61837887],\n",
       "       [86.04837363],\n",
       "       [88.31420163],\n",
       "       [74.46921155]])"
      ]
     },
     "execution_count": 61,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pred"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [],
   "source": [
    "def calc_lambda(df):\n",
    "    numerator = math.log(float(df['Nt']) / float(df['N0']))\n",
    "    lam = numerator / (-1 * float(df['t']))\n",
    "    return lam"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "def calc_half(df):\n",
    "    return math.log(2) / df['lambda']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\lzoeckler\\miniconda3\\envs\\DIAMETER\\lib\\site-packages\\ipykernel_launcher.py:6: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy\n",
      "  \n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>Hi_half_life</th>\n",
       "      <th>Med_half_life</th>\n",
       "      <th>Low_half_life</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>23oC</td>\n",
       "      <td>2315.663298</td>\n",
       "      <td>830.636875</td>\n",
       "      <td>1739.576004</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>30oC</td>\n",
       "      <td>428.983949</td>\n",
       "      <td>397.209718</td>\n",
       "      <td>426.702699</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>50oC</td>\n",
       "      <td>87.711358</td>\n",
       "      <td>105.384618</td>\n",
       "      <td>92.025929</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Pv_LDH</td>\n",
       "      <td>4oC</td>\n",
       "      <td>808.254122</td>\n",
       "      <td>1564.243383</td>\n",
       "      <td>1339.862434</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Pv_LDH</td>\n",
       "      <td>23oC</td>\n",
       "      <td>211.254384</td>\n",
       "      <td>196.495236</td>\n",
       "      <td>186.728350</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Pv_LDH</td>\n",
       "      <td>30oC</td>\n",
       "      <td>133.776544</td>\n",
       "      <td>134.498434</td>\n",
       "      <td>121.473584</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Pv_LDH</td>\n",
       "      <td>50oC</td>\n",
       "      <td>30.165834</td>\n",
       "      <td>32.164795</td>\n",
       "      <td>55.307855</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>4oC</td>\n",
       "      <td>539.223595</td>\n",
       "      <td>818.205035</td>\n",
       "      <td>773.406925</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>23oC</td>\n",
       "      <td>174.446928</td>\n",
       "      <td>168.679269</td>\n",
       "      <td>180.677475</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>30oC</td>\n",
       "      <td>114.718260</td>\n",
       "      <td>118.205629</td>\n",
       "      <td>111.456745</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>Pf_LDH</td>\n",
       "      <td>50oC</td>\n",
       "      <td>28.095870</td>\n",
       "      <td>31.228753</td>\n",
       "      <td>71.476407</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>CRP</td>\n",
       "      <td>4oC</td>\n",
       "      <td>392.551241</td>\n",
       "      <td>430.583050</td>\n",
       "      <td>500.093264</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>CRP</td>\n",
       "      <td>23oC</td>\n",
       "      <td>188.851647</td>\n",
       "      <td>237.330839</td>\n",
       "      <td>440.697605</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>CRP</td>\n",
       "      <td>30oC</td>\n",
       "      <td>215.064820</td>\n",
       "      <td>262.712856</td>\n",
       "      <td>338.675934</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>CRP</td>\n",
       "      <td>50oC</td>\n",
       "      <td>63.069248</td>\n",
       "      <td>72.635853</td>\n",
       "      <td>76.513589</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   analyte treatment_condition  Hi_half_life  Med_half_life  Low_half_life\n",
       "0     HRP2                23oC   2315.663298     830.636875    1739.576004\n",
       "1     HRP2                30oC    428.983949     397.209718     426.702699\n",
       "2     HRP2                50oC     87.711358     105.384618      92.025929\n",
       "3   Pv_LDH                 4oC    808.254122    1564.243383    1339.862434\n",
       "4   Pv_LDH                23oC    211.254384     196.495236     186.728350\n",
       "5   Pv_LDH                30oC    133.776544     134.498434     121.473584\n",
       "6   Pv_LDH                50oC     30.165834      32.164795      55.307855\n",
       "7   Pf_LDH                 4oC    539.223595     818.205035     773.406925\n",
       "8   Pf_LDH                23oC    174.446928     168.679269     180.677475\n",
       "9   Pf_LDH                30oC    114.718260     118.205629     111.456745\n",
       "10  Pf_LDH                50oC     28.095870      31.228753      71.476407\n",
       "11     CRP                 4oC    392.551241     430.583050     500.093264\n",
       "12     CRP                23oC    188.851647     237.330839     440.697605\n",
       "13     CRP                30oC    215.064820     262.712856     338.675934\n",
       "14     CRP                50oC     63.069248      72.635853      76.513589"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dfs = []\n",
    "for concentration in ['Hi', 'Med', 'Low']:\n",
    "    con_df = time_df[['analyte', 'treatment_condition', 'time_or_humidity',\n",
    "                      concentration, '{}_base'.format(concentration)]]\n",
    "    end_df = con_df.loc[con_df['time_or_humidity'] == 240.0]\n",
    "    end_df['decay'] = True\n",
    "    end_df.loc[end_df[concentration] > end_df['{}_base'.format(concentration)], 'decay'] = False\n",
    "    end_df.drop(['time_or_humidity', concentration, '{}_base'.format(concentration)], axis=1, inplace=True)\n",
    "    con_df = con_df.merge(end_df, on=['analyte', 'treatment_condition'])\n",
    "    calc_df = con_df.loc[con_df['decay'] == True]\n",
    "    calc_df = calc_df.loc[calc_df['time_or_humidity'] == 240.0]\n",
    "    calc_df.rename(columns={concentration: 'Nt', '{}_base'.format(concentration): 'N0',\n",
    "                            'time_or_humidity': 't'}, inplace=True)\n",
    "    calc_df['lambda'] = calc_df.apply(calc_lambda, axis=1)\n",
    "    calc_df['{}_half_life'.format(concentration)] = calc_df.apply(calc_half, axis=1)\n",
    "    calc_df.drop(['t', 'Nt', 'N0', 'decay', 'lambda'], axis=1, inplace=True)\n",
    "    dfs.append(calc_df)\n",
    "all_df = reduce(lambda left, right: pd.merge(left, right, on=['analyte', 'treatment_condition']), dfs)\n",
    "all_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [],
   "source": [
    "all_df.to_csv('C:/Users/lzoeckler/Desktop/decay/half_life.csv', index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>time_or_humidity</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "      <th>Hi_base</th>\n",
       "      <th>Med_base</th>\n",
       "      <th>Low_base</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>23oC</td>\n",
       "      <td>120.0</td>\n",
       "      <td>1239.33</td>\n",
       "      <td>683.33</td>\n",
       "      <td>80.44</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>23oC</td>\n",
       "      <td>240.0</td>\n",
       "      <td>1428.07</td>\n",
       "      <td>676.04</td>\n",
       "      <td>76.07</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>30oC</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1354.28</td>\n",
       "      <td>753.36</td>\n",
       "      <td>74.00</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>30oC</td>\n",
       "      <td>15.0</td>\n",
       "      <td>1286.84</td>\n",
       "      <td>650.77</td>\n",
       "      <td>68.25</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>30oC</td>\n",
       "      <td>60.0</td>\n",
       "      <td>1179.76</td>\n",
       "      <td>623.36</td>\n",
       "      <td>73.76</td>\n",
       "      <td>1534.43625</td>\n",
       "      <td>825.94375</td>\n",
       "      <td>83.70375</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   analyte treatment_condition  time_or_humidity       Hi     Med    Low  \\\n",
       "14    HRP2                23oC             120.0  1239.33  683.33  80.44   \n",
       "15    HRP2                23oC             240.0  1428.07  676.04  76.07   \n",
       "17    HRP2                30oC               3.0  1354.28  753.36  74.00   \n",
       "19    HRP2                30oC              15.0  1286.84  650.77  68.25   \n",
       "21    HRP2                30oC              60.0  1179.76  623.36  73.76   \n",
       "\n",
       "       Hi_base   Med_base  Low_base  \n",
       "14  1534.43625  825.94375  83.70375  \n",
       "15  1534.43625  825.94375  83.70375  \n",
       "17  1534.43625  825.94375  83.70375  \n",
       "19  1534.43625  825.94375  83.70375  \n",
       "21  1534.43625  825.94375  83.70375  "
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "filt = (time_df['Hi'] >= time_df['Hi_base']) | (time_df['Med'] >= time_df[\n",
    "    'Med_base']) | (time_df['Low'] >= time_df['Low_base'])\n",
    "time_df.loc[~filt].head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['Humidity'], dtype=object)"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "hum_df = main_df.loc[main_df['treatment_condition'] == 'Humidity']\n",
    "hum_df['treatment_condition'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0.7, 0.4])"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "hum_df['time_or_humidity'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>analyte</th>\n",
       "      <th>treatment_condition</th>\n",
       "      <th>time_or_humidity</th>\n",
       "      <th>Hi</th>\n",
       "      <th>Med</th>\n",
       "      <th>Low</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>160</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>Humidity</td>\n",
       "      <td>0.7</td>\n",
       "      <td>1523.30</td>\n",
       "      <td>858.96</td>\n",
       "      <td>96.40</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>HRP2</td>\n",
       "      <td>Humidity</td>\n",
       "      <td>0.4</td>\n",
       "      <td>2815.54</td>\n",
       "      <td>1217.88</td>\n",
       "      <td>106.56</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    analyte treatment_condition  time_or_humidity       Hi      Med     Low\n",
       "160    HRP2            Humidity               0.7  1523.30   858.96   96.40\n",
       "161    HRP2            Humidity               0.4  2815.54  1217.88  106.56"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "hum_df.loc[hum_df['analyte'] == 'HRP2']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
